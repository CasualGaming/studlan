{% extends "competition/competition_base.html" %}
{% load markup %}

{% block title %}
studLAN - Competition - {{ competition.title }}
{% endblock title %}

{% block content %}
    <div class="content">
        <h2>{{ competition }}</h2>
        
        <p>
            <span class="label {{ competition.status_label }}">{{ competition.status_text_verbose }}</span>
            <a href="#" class="label info" rel="popover" data-placement="below" data-html="true" data-content="{{ competition.activity.desc|markdown }}" data-original-title="{{ competition.activity.title }}">{{ competition.activity.title }}</a>
        </p>
        <div class="activity_image" style="background: url('{{ competition.activity.image_url }}');"></div>
        <br />

        {% comment %}
            Show participating teams
        {% endcomment %}
        {% if teams|length > 0 %}
            <h3>Participating teams</h3>
            <table class="zebra-striped">
                <thead><th>Team</th><th>Leader</th></thead>
                <tbody>
                    {% for team in teams %}
                        <tr>
                            <td><a href="{{ team.get_absolute_url }}">{{ team }}</a></td>
                            <td><a href="{% url profile team.leader %}">{{ team.leader }}</a></td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}
        {% if users %}
            <h3>Participants{% if teams %} without a team{% endif %}</h3>
            <ul>
                {% for user in users %}
                    <li><a href="{% url profile user %}">{{ user }}</a></li>
                {% endfor %}
            </ul>
        {% endif %}

        {% comment %}
             Participation form
        {% endcomment %}
        <hr />
        {% if user.is_authenticated %}
            {% if competition.status == 1 %}
                <p>
                {% if participating != 'team' %}
                    {% if competition.use_teams and owned_teams|length > 0 and participating != 'team' %}
                        <form action="{% url join_comp competition.id %}" method="POST">
                            {% csrf_token %}
                            <select name="team" id="team">
                                {% for team in owned_teams %}
                                    <option value="{{ team.id }}">{{ team }}</option>
                                {% endfor %}
                            </select>
                            <input class="btn success" type="submit" value="Join competition (team)"/>
                        </form>
                    {% endif %} 
                    {% if not participating %}
                        <form action="{% url join_comp competition.id %}" method="POST">{% csrf_token %}
                            <input type="submit" class="btn success" value="Join competition (solo)" />
                        </form>
                    {% endif %}
                {% endif %}
                {% if participating %}
                    <form action="{% url leave_comp competition.id %}" method="POST">
                        {% csrf_token %}
                        {% if participating == 'team' %}
                            <input type="submit" class="btn danger" value="Remove team from competition" />
                        {% else %}
                            <input type="submit" class="btn danger" value="Leave competition" />
                        {% endif %}
                    </form>
                {% endif %}
                </p>
            {% endif %}
            {% if competition.status == 3 %}
                <!-- not implemented...
                <a class="btn large danger" href="/competition/{{ competition.id }}/forfeit.html">Forfeit competition</a>
                -->
            {% endif %}
        {% endif %}
        <h3>Description</h3>
        <p>{{ competition.desc|markdown }}</p>

    </div>
{% endblock content %}
