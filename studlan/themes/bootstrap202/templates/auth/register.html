{% extends "base.html" %}

{% block title %}
studLAN - Register
{% endblock title %}

{% block navigation %}
    <ul class="nav">
        <li><a href="/">News</a></li>
        <li><a href="{% url competitions %}">Competitions</a></li>
        <li><a href="{% url teams %}">Teams</a></li>
    </ul>
{% endblock navigation %}

{% block content %}
    <div class="row">
        <div class="span9">
            {{ form.non_field_errors }}
            <form id="register-form"class="form-horizontal" method="post" action="{% url auth_register %}">{% csrf_token %}
                <fieldset>
                    <legend>Register new user</legend>
                    {% for field in form %}
                        {% comment %}
                        Code optimization for RadioSelect widget and bootstrap.
                        This way of printing radiobuttons will be implemented in django 1.4
                        {% ifequal field.label 'Gender' %}
                            <div class="control-group">
                                {{ field.label_tag }}
                                <ul class="inputs-list">
                                {% for radio in form.gender %}
                                    <li>{{ radio }}</li>
                                {% endfor %}
                                </ul>
                            </div>
                        {% endcomment %}
                        <div class="control-group">
                            <div class="control-label">{{ field.label_tag }}</div>
                            <div class="controls">
                                {{ field }}
                                {{ field.errors }}
                            </div>
                        </div>
                    {% endfor %}
                    <div class="form-actions">
                        <input type="submit" class="btn btn-primary" value="Register" />
                    </div>
                </fieldset>
            </form>
        </div>
    </div>

    <script language="javascript">
        $(document).ready(function(){
            $("#register-form").submit(function(){
                validateUsername(event);
            });

            function validateUsername(event) {
                var el = $("input[name='desired_username']");
                var errString = "Only a-Z, 0-9, -, _ allowed.";

                // If username contains other chars than alphanumerical + -+ _
                if (! /^[a-zA-Z0-9-_]+$/.test(el.val()) || el.val() == undefined) {
                    // If span element already exists - i.e. we've already gotten errors from the server
                    if(el.parent().has($("span.help-inline")).length) {
                        el.parent().find($("span.help-inline")).text(errString);
                    } else {
                        el.after("<span class='help-inline alert alert-error'>"+errString+"</span>");
                    }
                    event.preventDefault();
                }

                // ELSE: Submit as usual
            }

        });//document.ready
    </script>
{% endblock content %}
