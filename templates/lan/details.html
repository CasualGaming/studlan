{% extends "base.html" %}
{% load i18n %}
{% load markdown_deux_tags %}
{% load settings %}

{% block title %}
{{ lan }}
{% endblock title %}

{% block content %}
    <div class="row">
        <div class="col-md-8">
            <h1>{{ lan }}</h1>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <table class="table table-bordered">
                <tbody>
                    <tr><td>{% trans "Start date" %}:</td><td>{{ lan.start_date|date:"d. F Y" }} - {{ lan.start_date|time:"H:i" }}</td></tr> 
                    <tr><td>{% trans "End date" %}:</td><td>{{ lan.end_date|date:"d. F Y" }} - {{ lan.end_date|time:"H:i" }}</td></tr>
                    <tr><td>{% trans "Location" %}:</td><td>{{ lan.location }}</td></tr> 
                </tbody>
            </table>

            <hr />

            <p>
            {% if user.is_authenticated %}
                {% if status == 'paid' %}
                    <a class="btn btn-success disabled" href="#">{% trans "You have paid for this event" %}</a>
                {% endif %}
                {% if status == 'attending' %}
                    <a class="btn btn-danger" href="{% url 'lan_unattend' lan.id %}">{% trans "Remove attendance" %}</a>
                    {% if ticket_types %}
                        <br>
                        <div role="tabpanel">
                        <ul id="tabs" class="nav nav-tabs" role="tablist">
                        {% for ticket_type in ticket_types %}
                            <li {% if forloop.counter == 1 %} class="active" {% endif %} role="presentation">
                                <a href="#ticket-{{ forloop.counter }}" aria-controls="#ticket-{{ forloop.counter }}" data-toggle="tab" role="tab">{{ ticket_type.title }}</a>
                            </li>
                        {% endfor %}
                        </ul> 
                        <div class="tab-content">
                            {% for ticket_type in ticket_types %}
                                {% if forloop.counter == 1 %}
                                    <div role="tabpanel" class="tab-pane active well" id="ticket-{{ forloop.counter }}">
                                {% else %}
                                    <div role="tabpanel" class="tab-pane well" id="ticket-{{ forloop.counter }}">
                                {% endif %}
                                <pre>{{ ticket_type.descriptionÂ }}</pre>
                                <p><strong>Price: </strong>{{ ticket_type.price }}</p>
                                <p><strong>Free seats: </strong>{{ ticket_type.number_of_free_seats }}</p>
                                <form action="/payment/{{ ticket_type.id }}/" method="POST" class="inline">
                                    {% csrf_token %}
                                    <script
                                        src="https://checkout.stripe.com/checkout.js"
                                        class="stripe-button"
                                        data-key={% stripe_public_key %}
                                        data-image="/square-image.png"
                                        data-name={% site_name %}
                                        data-email={{ user.email }}
                                        data-description="{{ ticket_type.title }}"
                                        data-label="{% trans "Pay with Card" %}"
                                        data-allow-remember-me="false"
                                        data-currency="NOK"
                                        data-amount="{{ ticket_type.price }}00">
                                    </script>
                                </form>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% else %}
                        <p>No tickets avalible at this time</p>
                    {% endif %}
                {% endif %}
                {% if status == 'open' %}
                    {% if user.profile.has_address %}
                        <a class="btn btn-primary" href="{% url 'lan_attend' lan.id %}">{% trans "Sign up" %}</a>
                    {% else %}
                        <div class="alert alert-danger">
                            {% trans "Your address and zip code is required in order to sign up for a LAN." %}
                            {% trans "Go to your" %} <a href="{% url 'myprofile' %}">{% trans "profile" %}</a> {% trans "to add the information." %} 
                        </div>
                    {% endif %}
                {% endif %}
            {% else %}
                <div class="alert alert-danger">{% trans "You need to login to see your status." %}</div>
            {% endif %}
            </p>
        
            <hr />

            {{ lan.description|markdown }} 

        </div>
    </div>
{% endblock content %}
